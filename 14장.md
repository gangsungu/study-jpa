## 14장. 컬렉션과 부가기능

* 컬렉션
    - JPA는 자바에서 기본으로 제공하는 Collection, List, Set, Map 등 컬렉션을 지원한다
        + @OneToMany, @ManyToMany를 사용해서 일대다, 다대다 엔티티 관계를 매핑할 때
        + @ElementCollection을 사용하여 값 타입을 하나 이상 보관할 때
    
* JPA와 컬렉션
    - 하이버네이트는 엔티티를 영속 상태로 만들 때, 컬렉션 필드를 하이버네이트에서 준비한 컬렉션으로 감싸서 사용한다
    ```java
    @Entity
    public class Team {
        @Id
        private String id;

        @OneToMany
        @JoinColumn
        private Collection<Member> members = new ArrayList<Member>();
    }

    Team team = new Team();
    System.out.println(team.getMembers().getClass());
    em.persist();
    System.out.println(team.getMembers().getClass());

    // class java.util.ArrayList
    // class org.hibernate.collection.internal.PersistentBag
    ```
    > 원래 ArrayList 타입이던 컬렉션이 엔티티를 영속상태로 만든 직후, 하이버네이트가 제공하는 PersistentBag 타입으로 변경되었다.  

    - 하이버네이트는 컬렉션을 효율적으로 관리하기 위해서 엔티티를 영속 상태로 만들 때, 원본 컬렉션을 감싸고 있는 내장 컬렉션을 생성하고 이 내장 컬렉션을 사용하도록 참조를 변경한다.  이러한 특징때문에 컬렉션을 사용할 때, 다음처럼 초기화하여 사용하는 것을 권장한다.

    ```java
    Collection<Member> members = new ArrayList<Member>();
    ```